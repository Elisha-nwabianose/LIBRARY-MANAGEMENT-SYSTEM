<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Library Management System</title>
  <style>
    /* Times New Roman, layout similar to sample but modern */
    :root{--accent:#00ffcc;--dark:#0b6623}
    html,body{height:100%;margin:0;font-family:"Times New Roman", Times, serif;background:#f2f9f2;color:#033}
    .container{max-width:1100px;margin:18px auto;padding:16px}
    header{display:flex;align-items:center;gap:12px}
    header img{height:64px}
    header h1{margin:0;font-size:28px;color:var(--dark)}

    .layout{display:grid;grid-template-columns:220px 1fr;gap:16px;margin-top:16px}
    nav{background:linear-gradient(#0f8b3a,#0a6b2d);padding:10px;border-radius:6px}
    nav button{display:block;width:100%;margin:8px 0;padding:10px;border:none;background:#fff;color:var(--dark);font-weight:700;border-radius:4px;cursor:pointer}
    nav button.active{background:var(--accent);color:#003}

    main{background:#fff;border-radius:6px;padding:16px;min-height:520px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .panel{display:none}
    .panel.active{display:block}

    form .row{display:flex;gap:12px;align-items:center;margin:10px 0}
    label{min-width:120px}
    input[type=text],input[type=number],input[type=email],input[type=password],select,textarea{flex:1;padding:8px;border:1px solid #ccc;border-radius:4px}
    textarea{min-height:80px}
    .btn{background:var(--accent);border:none;padding:8px 12px;border-radius:4px;cursor:pointer}

    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border:1px solid #ddd;text-align:left}
    th{background:#f4fbf9}

    .small{font-size:13px;color:#555}
    .top-actions{display:flex;gap:8px;align-items:center}

    footer{margin-top:18px;font-size:13px;color:#444}
    @media(max-width:800px){.layout{grid-template-columns:1fr}nav{display:flex;overflow:auto}}

    /* Book grid for Read Books */
    .book-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .book-card {
      background: #ffffff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .book-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.12);
    }
    .book-card h3 {
      margin: 0;
      color: #064;
      font-size: 18px;
    }
    .book-card .author {
      font-size: 14px;
      color: #444;
      margin: 6px 0 12px;
    }
    .book-card .meta { font-size:13px;color:#666;margin-bottom:10px }
    .book-card button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: var(--accent);
      color: #002520;
      font-weight: bold;
      cursor: pointer;
      transition: .12s;
    }
    .book-card button:hover { transform: translateY(-1px) }
    /* ------------------------------
   OPTION A (Modern Green Theme)
   ------------------------------ */
:root.themeA {
  --accent:#00ffcc;
  --dark:#0b6623;
  --bg:#f2f9f2;
  --card:#ffffff;
  --navGradStart:#0f8b3a;
  --navGradEnd:#0a6b2d;
  --text:#003320;
}

/* ------------------------------
   OPTION B (Blue & White Clean UI)
   ------------------------------ */
:root.themeB {
  --accent:#4da3ff;
  --dark:#003e80;
  --bg:#f4f8ff;
  --card:#ffffff;
  --navGradStart:#005bbb;
  --navGradEnd:#004b99;
  --text:#002544;
}

/* Apply theme variables globally */
body {
  background: var(--bg);
  color: var(--text);
}

nav {
  background: linear-gradient(var(--navGradStart), var(--navGradEnd));
}

.book-card {
  background: var(--card);
}

.btn {
  background: var(--accent);
  color: #002520;
}

  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80'><rect width='80' height='80' fill='%2300ffcc'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-family='Times' font-size='18' fill='%23003020'>LIB</text></svg>" alt="logo">
      <div>
        <h1>LIBRARY MANAGEMENT SYSTEM</h1>
        <div class="small">Readers Are Leaders â€¢ Knowledge Is Key  </div>
      </div>
    </header>

    <div class="layout">
      <nav>
        <!-- data-role used to determine visibility per role -->
        <button id="themeToggle" data-role="all">Switch Theme</button>

        <button data-view="dashboard" data-role="all" class="active">Dashboard</button>
        <button data-view="add-book" data-role="admin">Add Book</button>
        <button data-view="books" data-role="all">Books</button>
        <button data-view="readbooks" data-role="all">Read Books</button>
        <button data-view="add-student" data-role="admin">Add Student</button>
        <button data-view="students" data-role="admin">Students</button>
        <button data-view="issue" data-role="admin">Issue / Return</button>
        <button data-view="reports" data-role="admin">Reports</button>

        <button id="seed" data-role="all">Seed Sample Data</button>
        <button id="clearData" data-role="all">Clear All Data</button>

        <!-- login / logout -->
        <button id="loginnar" data-view="login" data-role="all">Login</button>
        <button id="logoutBtn" data-role="all" style="display:none">Logout</button>
      </nav>

      <main>
        <!-- Dashboard -->
        <section id="dashboard" class="panel active">
          <h2>Dashboard</h2>
          <div class="small">Quick summary</div>
          <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
            <div style="flex:1;min-width:150px;background:#e9fff6;padding:12px;border-radius:6px">Books: <strong id="countBooks">0</strong></div>
            <div style="flex:1;min-width:150px;background:#fff6e9;padding:12px;border-radius:6px">Students: <strong id="countStudents">0</strong></div>
            <div style="flex:1;min-width:150px;background:#f0f6ff;padding:12px;border-radius:6px">Issued: <strong id="countIssues">0</strong></div>
          </div>
          <h3 style="margin-top:18px">Recent Activities</h3>
          <div id="activities" class="small">No activities yet.</div>
        </section>

        <!-- Add Book -->
        <section id="add-book" class="panel">
          <h2>Add New Book</h2>
          <form id="formAddBook">
            <div class="row"><label>Title</label><input id="book_title" required type="text"></div>
            <div class="row"><label>Author</label><input id="book_author" required type="text"></div>
            <div class="row"><label>Publication</label><input id="book_pub" type="text"></div>
            <div class="row"><label>Branch</label>
              <select id="book_branch"><option>General</option><option>Science</option><option>Engineering</option><option>Arts</option></select>
            </div>
            <div class="row"><label>Quantity</label><input id="book_qty" type="number" min="0" value="1"></div>
            <div class="row"><label>Price (â‚¦)</label><input id="book_price" type="number" min="0" value="0"></div>
            <div style="text-align:right;margin-top:12px"><button class="btn" type="submit">Add Book</button></div>
          </form>
        </section>
        
        <!-- Login (Admin / Student) -->
        <section id="login" class="panel">
          <h2> Login</h2>

          <div class="login-box">
            <h3>Choose Login Type</h3>
            <form id="formLogin">
              <div class="row"><label>Type</label>
                <select id="loginType">
                  <option value="student">Student</option>
                  <option value="admin">Admin</option>
                </select>
              </div>

              <div class="row"><label>Email / Matric</label>
                <input id="loginEmail" type="email" placeholder="Enter email or matric" required>
              </div>

              <div class="row"><label>Password</label>
                <input id="loginPassword" type="password" placeholder="Enter Password" required>
              </div>

              <div style="text-align:right;margin-top:12px">
                <button id="btnLoginSubmit" class="btn" type="submit">Login</button>
              </div>

              <p id="loginMessage" class="small" style="margin-top:8px"></p>
            </form>
          </div>
        </section>

        <!-- Read Books (grid of cards) -->
        <section id="readbooks" class="panel">
          <h2>ðŸ“– Read Books</h2>
          <div id="readBookGrid" class="book-grid"></div>
        </section>

        <!-- Books list (table) -->
        <section id="books" class="panel">
          <h2>Books</h2>
          <div class="top-actions">
            <input id="searchBook" placeholder="Search by title or author" style="padding:8px;flex:1">
            <button id="exportBooks" class="btn">Export JSON</button>
          </div>
          <table id="tblBooks"><thead><tr><th>ID</th><th>Title</th><th>Author</th><th>Branch</th><th>Qty</th><th>Price</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </section>

        <!-- Add Student -->
        <section id="add-student" class="panel">
          <h2>Add Student</h2>
          <!-- Added email + password fields so student accounts can be created -->
          <form id="formAddStudent">
            <div class="row"><label>Name</label><input id="stu_name" required type="text"></div>
            <div class="row"><label>Matric No.</label><input id="stu_matric" required type="text"></div>
            <div class="row"><label>Department</label><input id="stu_dept" type="text"></div>
            <div class="row"><label>Email</label><input id="stu_email" type="email" placeholder="student@example.com"></div>
            <div class="row"><label>Password</label><input id="stu_password" type="password" placeholder="password (optional)"></div>
            <div style="text-align:right;margin-top:12px"><button class="btn" type="submit">Add Student</button></div>
          </form>
        </section>

        <!-- Students list -->
        <section id="students" class="panel">
          <h2>Students</h2>
          <table id="tblStudents"><thead><tr><th>ID</th><th>Name</th><th>Matric</th><th>Dept</th><th>Email</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </section>

        <!-- Issue / Return -->
        <section id="issue" class="panel">
          <h2>Issue / Return Book</h2>
          <form id="formIssue">
            <div class="row"><label>Student</label>
              <select id="issue_student"></select>
            </div>
            <div class="row"><label>Book</label>
              <select id="issue_book"></select>
            </div>
            <div class="row"><label>Return Due (days)</label><input id="issue_days" type="number" min="1" value="7"></div>
            <div style="text-align:right;margin-top:12px"><button class="btn" type="submit">Issue Book</button></div>
          </form>

          <h3 style="margin-top:18px">Currently Issued</h3>
          <table id="tblIssues"><thead><tr><th>Issue ID</th><th>Student</th><th>Book</th><th>Issued</th><th>Due</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </section>

        <!-- Reports -->
        <section id="reports" class="panel">
          <h2>Reports</h2>
          <div class="small">Export data or view summary.</div>
          <div style="margin-top:12px">
            <button id="downloadAll" class="btn">Download All Data (JSON)</button>
            <button id="restoreSample" class="btn">Restore Sample</button>
          </div>
          <h3 style="margin-top:12px">Raw Data</h3>
          <pre id="rawData" style="background:#f9f9f9;padding:8px;border-radius:6px;max-height:300px;overflow:auto"></pre>
        </section>

      </main>
    </div>

    <footer>Library Academic Project â€¢ Solving Real-Life Problems</footer>
  </div>

  <script>
    // Simple app using localStorage
    const STORAGE_KEYS = {books:'lms_books', students:'lms_students', issues:'lms_issues', activities:'lms_activities'};

    // Navigation click handler (generic)
    document.querySelectorAll('nav button[data-view]').forEach(btn => btn.addEventListener('click', (e) => {
      const view = btn.getAttribute('data-view');
      // ensure control by role (button's visibility already managed)
      switchView(view);
      refreshAll();
    }));

    // Helpers
    function read(key){ return JSON.parse(localStorage.getItem(key) || '[]') }
    function write(key,val){ localStorage.setItem(key, JSON.stringify(val)) }
    function activitiesLog(text){ const arr = read(STORAGE_KEYS.activities); arr.unshift({t:new Date().toLocaleString(), txt:text}); write(STORAGE_KEYS.activities, arr.slice(0,50)); }

    // Seed / clear buttons
    document.getElementById('seed').addEventListener('click', ()=>{ seedSample(); refreshAll(); alert('Sample data seeded'); });
    document.getElementById('clearData').addEventListener('click', ()=>{ if(confirm('Clear all data?')){ localStorage.clear(); refreshAll(); alert('Cleared'); } });

    // Add Book
    document.getElementById('formAddBook').addEventListener('submit', e => {
      e.preventDefault();
      const bks = read(STORAGE_KEYS.books);
      const book = {
        id: Date.now(),
        title: document.getElementById('book_title').value.trim(),
        author: document.getElementById('book_author').value.trim(),
        pub: document.getElementById('book_pub').value,
        branch: document.getElementById('book_branch').value,
        qty: parseInt(document.getElementById('book_qty').value) || 0,
        price: parseFloat(document.getElementById('book_price').value) || 0
      };
      bks.push(book); write(STORAGE_KEYS.books, bks);
      activitiesLog('Added book: ' + book.title);
      e.target.reset();
      refreshAll();
    });

    // Add Student (now stores email + password)
    document.getElementById('formAddStudent').addEventListener('submit', e => {
      e.preventDefault();
      const students = read(STORAGE_KEYS.students);
      const name = document.getElementById('stu_name').value.trim();
      const matric = document.getElementById('stu_matric').value.trim();
      const dept = document.getElementById('stu_dept').value.trim();
      const email = document.getElementById('stu_email').value.trim();
      let password = document.getElementById('stu_password').value;
      // fallback: use matric as password if not supplied
      if (!password) password = matric || 'password';
      const s = { id: Date.now(), name, matric, dept, email, password };
      students.push(s); write(STORAGE_KEYS.students, students);
      activitiesLog('Added student: ' + s.name);
      e.target.reset();
      refreshAll();
    });

    // Issue Book
    document.getElementById('formIssue').addEventListener('submit', e => {
      e.preventDefault();
      const studentId = +document.getElementById('issue_student').value;
      const bookId = +document.getElementById('issue_book').value;
      const days = +document.getElementById('issue_days').value || 7;
      const books = read(STORAGE_KEYS.books); const book = books.find(b => b.id === bookId);
      if (!book || book.qty < 1) { alert('Book not available'); return; }
      book.qty -= 1; write(STORAGE_KEYS.books, books);
      const issues = read(STORAGE_KEYS.issues);
      const iss = { id: Date.now(), studentId, bookId, issuedAt: new Date().toISOString(), dueAt: new Date(Date.now() + days*24*3600*1000).toISOString() };
      issues.push(iss); write(STORAGE_KEYS.issues, issues);
      activitiesLog('Issued book: ' + book.title);
      refreshAll();
    });

    // Return Book
    function returnIssue(issueId){
      const issues = read(STORAGE_KEYS.issues); const idx = issues.findIndex(i => i.id === issueId);
      if (idx === -1) return;
      const issue = issues[idx]; issues.splice(idx,1); write(STORAGE_KEYS.issues, issues);
      const books = read(STORAGE_KEYS.books); const book = books.find(b => b.id === issue.bookId);
      if (book) { book.qty += 1; write(STORAGE_KEYS.books, books); }
      activitiesLog('Returned book id ' + issue.bookId);
      refreshAll();
    }

    // Render everything
    function refreshAll(){ renderCounts(); renderBooks(); renderStudents(); renderIssueForm(); renderIssues(); renderActivities(); renderRaw(); renderReadBooks(); updateNavForRole(); }
    function renderCounts(){
      document.getElementById('countBooks').textContent = read(STORAGE_KEYS.books).length;
      document.getElementById('countStudents').textContent = read(STORAGE_KEYS.students).length;
      document.getElementById('countIssues').textContent = read(STORAGE_KEYS.issues).length;
    }

    function renderBooks(filter){
      const tbody = document.querySelector('#tblBooks tbody'); tbody.innerHTML = '';
      const books = read(STORAGE_KEYS.books);
      const q = (filter || '').toLowerCase();
      books.filter(b => !q || b.title.toLowerCase().includes(q) || b.author.toLowerCase().includes(q)).forEach(b => {
        const tr = document.createElement('tr');
        const priceText = (typeof b.price === 'number' && !isNaN(b.price)) ? 'â‚¦' + b.price.toFixed(2) : 'â‚¦0.00';
        tr.innerHTML = `<td>${b.id}</td><td>${escapeHtml(b.title)}</td><td>${escapeHtml(b.author)}</td><td>${escapeHtml(b.branch)}</td><td>${b.qty}</td><td>${priceText}</td><td><button data-id='${b.id}' class='editBtn'>Edit</button> <button data-id='${b.id}' class='delBtn'>Delete</button></td>`;
        tbody.appendChild(tr);
      });
      // actions (delegate after rows created)
      tbody.querySelectorAll('.delBtn').forEach(btn => btn.addEventListener('click', () => {
        if (confirm('Delete book?')) {
          const id = +btn.dataset.id; let arr = read(STORAGE_KEYS.books); arr = arr.filter(x => x.id !== id); write(STORAGE_KEYS.books, arr);
          activitiesLog('Deleted book id ' + id); refreshAll();
        }
      }));
      tbody.querySelectorAll('.editBtn').forEach(btn => btn.addEventListener('click', () => {
        const id = +btn.dataset.id; const books = read(STORAGE_KEYS.books); const b = books.find(x => x.id === id); if (!b) return;
        const newTitle = prompt('Title', b.title); if (newTitle !== null) {
          b.title = newTitle; write(STORAGE_KEYS.books, books.map(x => x.id === b.id ? b : x)); activitiesLog('Edited book: ' + b.title); refreshAll();
        }
      }));
    }

    document.getElementById('searchBook').addEventListener('input', e => renderBooks(e.target.value));

    function renderStudents(){
      const tbody = document.querySelector('#tblStudents tbody'); tbody.innerHTML = '';
      read(STORAGE_KEYS.students).forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s.id}</td><td>${escapeHtml(s.name)}</td><td>${escapeHtml(s.matric)}</td><td>${escapeHtml(s.dept)}</td><td>${escapeHtml(s.email||'')}</td><td><button data-id='${s.id}' class='delS'>Delete</button></td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('.delS').forEach(btn => btn.addEventListener('click', () => {
        if (confirm('Delete student?')) {
          const id = +btn.dataset.id; let arr = read(STORAGE_KEYS.students); arr = arr.filter(x => x.id !== id); write(STORAGE_KEYS.students, arr);
          activitiesLog('Deleted student id ' + id); refreshAll();
        }
      }));
    }

    function renderIssueForm(){
      const selS = document.getElementById('issue_student'); const selB = document.getElementById('issue_book'); selS.innerHTML = ''; selB.innerHTML = '';
      read(STORAGE_KEYS.students).forEach(s => { const o = document.createElement('option'); o.value = s.id; o.textContent = s.name + ' (' + s.matric + ')'; selS.appendChild(o); });
      read(STORAGE_KEYS.books).forEach(b => { const o = document.createElement('option'); o.value = b.id; o.textContent = b.title + ' â€” (' + b.qty + ' available)'; selB.appendChild(o); });
    }

    function renderIssues(){
      const tbody = document.querySelector('#tblIssues tbody'); tbody.innerHTML = '';
      const issues = read(STORAGE_KEYS.issues); const students = read(STORAGE_KEYS.students); const books = read(STORAGE_KEYS.books);
      issues.forEach(i => {
        const s = students.find(x => x.id === i.studentId); const b = books.find(x => x.id === i.bookId);
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i.id}</td><td>${s ? escapeHtml(s.name) : 'Unknown'}</td><td>${b ? escapeHtml(b.title) : 'Unknown'}</td><td>${new Date(i.issuedAt).toLocaleDateString()}</td><td>${new Date(i.dueAt).toLocaleDateString()}</td><td><button data-id='${i.id}' class='retBtn'>Return</button></td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('.retBtn').forEach(btn => btn.addEventListener('click', () => { if (confirm('Mark as returned?')) { returnIssue(+btn.dataset.id); } }));
    }

    function renderActivities(){
      const el = document.getElementById('activities'); const arr = read(STORAGE_KEYS.activities);
      if (!arr || arr.length === 0) { el.textContent = 'No activities yet.'; return; }
      el.innerHTML = '<ul style="margin:8px 0 0 18px">' + arr.slice(0,10).map(a => `<li><strong>${escapeHtml(a.t)}</strong>: ${escapeHtml(a.txt)}</li>`).join('') + '</ul>';
    }

    function renderRaw(){
      document.getElementById('rawData').textContent = JSON.stringify({books:read(STORAGE_KEYS.books), students:read(STORAGE_KEYS.students), issues:read(STORAGE_KEYS.issues)}, null, 2);
    }

    // Render Read Books grid (cards)
    function renderReadBooks(){
      const grid = document.getElementById('readBookGrid'); grid.innerHTML = '';
      const books = read(STORAGE_KEYS.books);
      if (!books.length) { grid.innerHTML = '<div class="small">No books available.</div>'; return; }
      books.forEach(b => {
        const card = document.createElement('div'); card.className = 'book-card';
        card.innerHTML = `<h3>${escapeHtml(b.title)}</h3><div class="author">by ${escapeHtml(b.author)}</div><div class="meta">Branch: ${escapeHtml(b.branch)} â€¢ Qty: ${b.qty} â€¢ â‚¦${(typeof b.price==='number' ? b.price.toFixed(2) : '0.00')}</div><button data-id="${b.id}">Read</button>`;
        grid.appendChild(card);
      });
      grid.querySelectorAll('button').forEach(btn => btn.addEventListener('click', () => {
        const id = +btn.dataset.id; const b = read(STORAGE_KEYS.books).find(x => x.id === id);
        if (!b) { alert('Book not found'); return; }
        // Simulate reading: show small preview and log activity
        activitiesLog('Read book: ' + b.title);
        // Simple preview modal using alert (you can replace with custom modal)
        alert(`Reading: ${b.title}\nAuthor: ${b.author}\nPublication: ${b.pub || 'N/A'}\n\nNote: This is a preview placeholder.`);
        refreshAll();
      }));
    }

    // Export / download
    document.getElementById('downloadAll').addEventListener('click', () => {
      const data = {books: read(STORAGE_KEYS.books), students: read(STORAGE_KEYS.students), issues: read(STORAGE_KEYS.issues)};
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'}); const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = 'lms_data_' + Date.now() + '.json'; a.click();
    });
    document.getElementById('exportBooks').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(read(STORAGE_KEYS.books), null, 2)], {type:'application/json'}); const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = 'books_' + Date.now() + '.json'; a.click();
    });
    document.getElementById('restoreSample').addEventListener('click', () => { seedSample(); refreshAll(); alert('Sample restored'); });

    // Utilities
    function escapeHtml(s){ if (!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;') }

    // Sample data
    function seedSample(){
      const books = [
        {id:1111,title:'Engineering Mathematics',author:'K.A. Stroud',pub:'Pearson',branch:'Engineering',qty:5,price:2500},
        {id:2222,title:'Introduction to Algorithms',author:'Cormen et al',pub:'MIT Press',branch:'Science',qty:3,price:4500},
        {id:3333,title:'Discrete Mathematics',author:'Rosen',pub:'McGraw',branch:'Engineering',qty:2,price:2200}
      ];
      const students = [
        // sample students include email and password
        {id:9001,name:'Aisha Bello',matric:'ENG/2019/001',dept:'Electrical', email:'aisha@example.com', password:'ENG/2019/001'},
        {id:9002,name:'John Doe',matric:'SCI/2020/045',dept:'Computer Science', email:'john@example.com', password:'SCI/2020/045'}
      ];
      const issues = [
        {id:5001,studentId:9001,bookId:1111,issuedAt:new Date().toISOString(),dueAt:new Date(Date.now()+7*24*3600*1000).toISOString()}
      ];
      write(STORAGE_KEYS.books, books); write(STORAGE_KEYS.students, students); write(STORAGE_KEYS.issues, issues);
      write(STORAGE_KEYS.activities, [{t:new Date().toLocaleString(), txt:'Seeded sample data'}]);
    }

    // ------------------- LOGIN / AUTH -------------------

    // Helper to get current session
    function getSession(){ return JSON.parse(localStorage.getItem('lms_loggedin') || 'null') }

    // Switch view helper (keeps nav active class)
    function switchView(viewId){
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      // activate the nav button linked to that view if present
      const navBtn = document.querySelector(`nav button[data-view="${viewId}"]`);
      if (navBtn) navBtn.classList.add('active');
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      const panel = document.getElementById(viewId);
      if (panel) panel.classList.add('active');
      refreshAll();
    }

    // Update nav visibility based on role
    function updateNavForRole(){
      const session = getSession();
      document.getElementById('logoutBtn').style.display = session ? 'block' : 'none';
      // Show/hide nav items
      document.querySelectorAll('nav button[data-role]').forEach(btn => {
        const role = btn.getAttribute('data-role') || 'all';
        if (!session) {
          // Not logged in: show only "all" items and login, seed, clear
          const allowed = role === 'all';
          btn.style.display = allowed ? 'block' : 'none';
        } else if (session.type === 'admin') {
          // admin sees all
          btn.style.display = 'block';
        } else if (session.type === 'student') {
          // student sees only 'all' (dashboard/books/readbooks) and login/logout/seed/clear
          const allowed = role === 'all';
          btn.style.display = allowed ? 'block' : 'none';
        } else {
          btn.style.display = 'none';
        }
      });

      // Ensure login button hidden when logged in and logout shown
      const loginBtn = document.getElementById('loginnar');
      if (getSession()) loginBtn.style.display = 'none';
      else loginBtn.style.display = 'block';
    }

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('lms_loggedin');
      activitiesLog('User logged out');
      updateNavForRole();
      switchView('login');
    });

    // Form login handler (handles admin + student)
    document.getElementById('formLogin').addEventListener('submit', function(e){
      e.preventDefault();
      const type = document.getElementById("loginType").value;
      const email = document.getElementById("loginEmail").value.trim();
      const pass = document.getElementById("loginPassword").value.trim();
      const msg = document.getElementById("loginMessage");
      msg.style.color = "red";
      if (!email || !pass){ msg.textContent = "Please enter email and password."; return; }

      // Admin credentials (hard-coded)
      if (type === "admin"){
        const adminEmail = "admin@library.com";
        const adminPass = "admin123";
        if (email.toLowerCase() === adminEmail && pass === adminPass){
          localStorage.setItem("lms_loggedin", JSON.stringify({ type: "admin", email: adminEmail }));
          msg.style.color = "green";
          msg.textContent = "Admin login successful!";
          activitiesLog('Admin logged in');
          updateNavForRole();
          // go to dashboard
          setTimeout(()=> switchView('dashboard'), 300);
          return;
        } else {
          msg.textContent = "Incorrect admin login details.";
          return;
        }
      }

      // Student login: match by email OR matric + password
      if (type === "student"){
        const students = read(STORAGE_KEYS.students);
        const found = students.find(stu => ((stu.email && stu.email.toLowerCase() === email.toLowerCase()) || (stu.matric && stu.matric.toLowerCase() === email.toLowerCase())) && stu.password === pass);
        if (found){
          localStorage.setItem("lms_loggedin", JSON.stringify({ type: "student", id: found.id, name: found.name }));
          msg.style.color = "green";
          msg.textContent = "Student login successful!";
          activitiesLog('Student logged in: ' + found.name);
          updateNavForRole();
          setTimeout(()=> switchView('dashboard'), 300);
          return;
        } else {
          msg.textContent = "Incorrect student email/matric or password.";
          return;
        }
      }
    });

    // ------------------- END LOGIN / AUTH -------------------

    // Utilities continued...

    // Remove items with empty arrays on first load
    function initIfEmpty(){
      if (read(STORAGE_KEYS.books).length === 0 && read(STORAGE_KEYS.students).length === 0) seedSample();
    }

    // Initialization
    initIfEmpty();
    refreshAll();

    // If session exists, automatically show dashboard; else show login panel
    window.addEventListener('load', () => {
      updateNavForRole();
      const session = getSession();
      if (session) switchView('dashboard'); else switchView('login');
    });
    // THEME SWITCHING (Option A / Option B)
if (!localStorage.getItem('lms_theme')) {
  localStorage.setItem('lms_theme', 'A'); // default
}

applyTheme(localStorage.getItem('lms_theme'));

document.getElementById('themeToggle').addEventListener('click', () => {
  const current = localStorage.getItem('lms_theme');
  const next = current === 'A' ? 'B' : 'A';
  localStorage.setItem('lms_theme', next);
  applyTheme(next);
});

function applyTheme(theme){
  document.documentElement.classList.remove('themeA','themeB');
  document.documentElement.classList.add(theme === 'A' ? 'themeA' : 'themeB');
}


  </script>
</body>
</html>
